---
title: "Neural Analysis (Ramps and Vibrations)"
author: "Arthur Harnisch"
date: "December 10, 2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)#echo = TRUE means that in the knit file the code will be displayed. 
```
###Outline of R Code Function for Muscle Tension Analysis and Graphs

Experiments are conducted as a repeated measure design. Treatment and control experiments were conducted as separate trials. Trials typically occur for 100 minutes, but may occur for more or less time depending on protocol and quality of type Ia muscle spindle afferent firing. 

At the time this code was written the python code to gather time points was under development. Once the python code is finished it will gather the data for resting discharge, DP, IST, FST, DI, 50 hz vibrations, 100 hz vibrations. 

The python out-put is .csv and the file name was saved as analyzed year, month, date, muscle number, and trial letter (ie. 170109-1a). Under the file directory in a folder entitled Neural_R, four folders exist experiment, control, img, plot_output and experiment output. Python.csv files are to be placed under either experiment and control based on the type of trial, the image for the graph (point 6 below) placed in folder img entitled img (png file), and excel output will receive the excel output from the r code that organizes relevant data values grouped for each trial on one sheet. The features of this r code are listed below.  

The idea of this code was to consider all of the possible types of graphs that we would need to generate for this lab. If you are only interested in some of the graphs you can press the play icon in the chunk, copy the section of code to a new r mark down file, or find the plot you want write x1 = before the plot code then copy: 

library(ggplot2)
ggsave('file.name.png', plot = x1, device = 'png', path = 'C:\\Users\\Arthur\\255E\\Neural_R\\plot_output')

this will save the plot as a .png file in the same directory as the Experiment and control files were placed in a folder entitled plot_output. 


1. Imports multiple.csv files for both experiment and control and creates a data frame of all .csv files for each (Exp, and Control). The name of the file is used to organize the information within the data frame. 

2. Calculates the percent change from baseline for resting discharge, DP, IST, FST, DI, 50 hz vibrations, 100 hz vibrations in seperate columns for experiment and control. 

3. Produces combination line plots for Resting discharge, DP, IST, FST, DI, 50 hz vibrations, 100 hz vibrations that shows the percent change from baseline (first 20 minutes of experiment) over time of the experiment and contains a legend for the date of each trial. Each graph is produced independently as well as grouped multi-plots of treatment and control. 

4. Produces a line plot of averages compared to time of experiment for multiple trials for average SR 3.25-3.75 of 4 sec. static stretch with error bars. This code will produce a graph of averages for treatment and control, a single plot of averages with two lines with error bars for treatment and control, and both individual graphs of average treatment and control faceted together.  

5. Produces graphs of dot plots with error bars of the average SR (3.25-3.75 of static stretch) per 20 minutes of the experiment for every trial. Graphs are produced independently for treatment and control, a multiplot that shows treatment and control, and a single graph that shows treatment and control.    


6. Produces graphs of dotplots with error bars of 50 Hz vibrations, 100 Hz vibrations for experiment and control for every trial. Graphs are produced independently for treatment and control, a multiplot that shows treatment and control, and a single graph that shows treatment and control.  






6. Produces a line plot of peak tension as a percent variation from baseline tension over time of experiment. This graph also includes a picture of the afferent firing caused by the first static stretch. The caption of this graph lists the standard deviation values for each 20-minute period of the experiment. 

7. outputs a table for 10 sec. before static stretch (baseline tension), peak tension, average tension 3.25-3.75 of 4 sec. static stretch, and minimum tension in an excel (xlsx) format. 
note: 

Required packages: ggplot2, dplyr, splitstackshape, reshape, grid, png.


### setting the working directory 

```{r directory}
#set user directory by copying line 40 to console

setwd("C:/Users/Arthur/255E")


```

###Installing Packages
this chunk lists packages that are required for the code to function. All of the items in this chunk are commented out so that the r markdown can knit. The packages should only need to be installed the first time the code is used to ensure the code wil perform the appropriate functions.   

```{r packageInstall}
# Packages necessary for this r code
#sections are commented out so document can knit

#if you have not used this code on this computer remove all of the # next to install.packages("...") so package can be installed. 

#ggplot2

#install.packages("ggplot2") 


#dplyr
#install.packages("dplyr")

#splitstackshape
#install.packages("splitstackshape")


#reshape
#install.packages("reshape")

#reshape2
#install.packages("reshape2")


#png
#install.packages("png")

#grid
#install.packages("grid")

#xlsx
#install.packages("xlsx")


```
###Importing data

A folder named Neural_R was created so that multiple .csv files could be placed into it and analyzed. In this folder there are two folders, Experiment and Control. ".csv"" files from experiment, or control files are placed under appropriate folder.    

```{r dataImport}

#multiple data import for experiment by use of for loop to find .csv files and rbind to single data frame for Experiment. 

#myfiles is a new data frame for all .csv files from Experiment folder 
myfiles=dir(path = "C:/Users/Arthur/255E/Neural_R/Experiment", pattern = "*.csv$", all.files = TRUE, full.names = TRUE)


#for loop loops over myfiles

for(i in 1: length(myfiles) ){
  
  #open each file
   read.csv(myfiles[i])
  temp = read.csv(myfiles[i])
  fname = basename(myfiles[i])
  
  #locates the year month day, muscle number, and trial number 
  
  loc = regexpr(pattern = "[[:digit:]]+[-_][[:digit:]][[:alpha:]]", text = fname)
  trial = substr(fname, start = loc[[1]], stop = loc[[1]] + (attr(loc,'match.length')-1))
  trial = sub(pattern = '_','-', x= trial)
  
  temp2 = temp[-(which(temp$Ramp.. == '')),]
  
  
  macroRows = which(temp2$Ramp.. == 'for macro #:')
  
  temp2$Macro = NA
  
  for (j in 1:length(macroRows)){
    macroNum = temp2$Resting.discharge[macroRows[j]]
    if (j < length(macroRows)){
      temp2$Macro[(macroRows[j]+1) : (macroRows[j+1]-1) ] = macroNum
    } else if (j == length(macroRows)){
      temp2$Macro[(macroRows[j]+1) : nrow(temp2) ] = macroNum
    }
  }
  
  temp2 = temp2[-(macroRows), ]
  temp2 = droplevels(temp2)
  temp2$Ramp.. = as.numeric(as.character(temp2$Ramp..))
  temp2$Ramp..[temp2$Ramp.. == 0] = 6
  
  temp2$Trial = trial


  
  if ( i == 1){
    Exp = temp2
  } else {
    Exp = rbind( Exp, temp2)
  }
}






#create a data frame for control

myfiles=dir("C:/Users/Arthur/255E/Neural_R/Control", pattern = "*.csv$", all.files = TRUE, full.names = TRUE)

# For control 
for(i in 1: length(myfiles) ){
  
  #open each file
  # read.csv(myfiles[i])
  temp = read.csv(myfiles[i])
  fname = basename(myfiles[i])
  
  loc = regexpr(pattern = "[[:digit:]]+[-_][[:digit:]][[:alpha:]]", text = fname)
  trial = substr(fname, start = loc[[1]], stop = loc[[1]] + (attr(loc,'match.length')-1))
  trial = sub(pattern = '_','-', x= trial)
  
  temp2 = temp[-(which(temp$Ramp.. == '')),]
  
  macroRows = which(temp2$Ramp.. == 'for macro #:')
  
  temp2$Macro = NA
  
  for (j in 1:length(macroRows)){
    macroNum = temp2$Resting.discharge[macroRows[j]]
    if (j < length(macroRows)){
      temp2$Macro[(macroRows[j]+1) : (macroRows[j+1]-1) ] = macroNum
    } else if (j == length(macroRows)){
      temp2$Macro[(macroRows[j]+1) : nrow(temp2) ] = macroNum
    }
  }
  
  temp2 = temp2[-(macroRows), ]
  temp2 = droplevels(temp2)
  temp2$Ramp.. = as.numeric(as.character(temp2$Ramp..))
  temp2$Ramp..[temp2$Ramp.. == 0] = 6
  
  temp2$Trial = trial


  
  if ( i == 1){
    Control = temp2
  } else {
    Control = rbind( Control, temp2)
  }
}


              

```

###Data manipulation, Percent change from Baseline of Experiment

This code finds the percent change from baseline for Resting discharge, DP, IST, FST, DI, 50 hz vibrations, 100 hz vibrations for experiment. 

The calculations below are not converted to a percent, but will be done so latter when graphing. 

```{r dataManipulation_EXP}

#calculates the percept change from baseline for each of the trials and makes a seperate column to display the percent from variation 10 sec. before static stretch (baseline tension), peak tension, average tension 3.25-3.75 of 4 sec. static stretch, and minimum tension. 



#data manipulations are for Experiment group


# finding the percent change from baseline (first 6 time points of file) of Resting.discharge 

 

library(dplyr)
Exp1 = tbl_df(Exp)

#res = filter(Exp1, Macro == 1, Ramp.. <7)   #dplyr filter 

 res1 = Exp1[Exp1$Macro == 1 & Exp1$Ramp.. < 7,] #base r filter 

res2 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_reseting.discharge = mean(Resting.discharge, na.rm = TRUE))


  Exp$avg_reseting.discharge = res2$avg_reseting.discharge[match(Exp$Trial, res2$Trial)]


Exp$pcb.resting.discharge = Exp$Resting.discharge / Exp$avg_reseting.discharge


#finding the percent variation from baseline in DP

res3 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_DP = mean(DP, na.rm = TRUE))


 Exp$avg_DP = res3$avg_DP[match(Exp$Trial, res3$Trial)]
 
 Exp$pcb.DP = Exp$DP / Exp$avg_DP
 
 #finding the percent change form baseline in IST
 
 
 res4 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_IST = mean(IST, na.rm = TRUE))


 Exp$avg_IST = res4$avg_IST[match(Exp$Trial, res4$Trial)]
 
 Exp$pcb.IST = Exp$IST / Exp$avg_IST

 
  #finding the percent variation form baseline in FST
 
 
 res5 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_FST = mean(FST, na.rm = TRUE))


 Exp$avg_FST = res5$avg_FST[match(Exp$Trial, res5$Trial)]
 
 Exp$pcb.FST = Exp$FST / Exp$avg_FST
 
 
 # finding the percent variation from baseline in DI

 
  
 res6 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_DI = mean(DI, na.rm = TRUE))


 Exp$avg_DI = res6$avg_DI[match(Exp$Trial, res6$Trial)]
 
 Exp$pcb.DI = Exp$DI / Exp$avg_DI
 
  
 # finding the percent change from baseline in 50Hz vibrations

 
  
 res7 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_50hz = mean(X50hz.frequency, na.rm = TRUE))


 Exp$avg_50hz = res7$avg_50hz[match(Exp$Trial, res7$Trial)]
 
 Exp$pcb.50hz = Exp$X50hz.frequency / Exp$avg_50hz
 
 
  
 # finding the percent change from baseline in 100 Hz vibrations

 
  
 res8 = res1 %>%
  group_by(Trial)%>%
  summarise(avg_100hz = mean(X100hz.frequency, na.rm = TRUE))


 Exp$avg_100hz = res8$avg_100hz[match(Exp$Trial, res8$Trial)]
 
 Exp$pcb.100hz = Exp$X100hz.frequency / Exp$avg_100hz
 
 
 #creating numeric x-axis for plotting that will label the ramp number in the file for each file. 
 
 library(splitstackshape)
 
 Exp5 = getanID(data = Exp, id.vars = "Trial")
 
Exp$ramp.num = Exp5$.id

 
```



###Percent variation from baseline of Control

This is a code to find the percent change from baseline of the files that were placed in the folder labeled Control 


```{r dataManipulation_Control}


 #data manipulation for Control
 library(dplyr)

 control1 = tbl_df(Control)

# res = filter(Exp1, Macro == 1, Ramp.. <7)   #dplyr filter 

 con1 = control1[control1$Macro == 1 & control1$Ramp.. < 7,] #base r filter 

con2 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_reseting.discharge = mean(Resting.discharge, na.rm = TRUE))


  Control$avg_reseting.discharge = con2$avg_reseting.discharge[match(Control$Trial, con2$Trial)]


Control$pcb.resting.discharge = Control$Resting.discharge / Control$avg_reseting.discharge


 #finding the percent change from baseline in DP

con3 = con1 %>%
  group_by(Trial)%>%
summarise(avg_DP = mean(DP, na.rm = TRUE))


 Control$avg_DP = con3$avg_DP[match(Control$Trial, con3$Trial)]
 
 Control$pcb.DP = Control$DP / Control$avg_DP
 
 
  #finding the percent change form baseline in IST
 
 
 con4 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_IST = mean(IST, na.rm = TRUE))


 Control$avg_IST = con4$avg_IST[match(Control$Trial, con4$Trial)]
 
 Control$pcb.IST = Control$IST / Control$avg_IST

 
  #finding the percent change form baseline in FST
  
 con5 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_FST = mean(FST, na.rm = TRUE))


 Control$avg_FST = con5$avg_FST[match(Control$Trial, con5$Trial)]
 
 Control$pcb.FST = Control$FST / Control$avg_FST

 
 
 # finding the percent variation from baseline in DI

 
  
 con6 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_DI = mean(DI, na.rm = TRUE))


 Control$avg_DI = con6$avg_DI[match(Control$Trial, con6$Trial)]
 
 Control$pcb.DI = Control$DI / Control$avg_DI
 
  
 # finding the percent change from baseline in 50Hz vibrations

 
  
 con7 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_50hz = mean(X50hz.frequency, na.rm = TRUE))


 Control$avg_50hz = con7$avg_50hz[match(Control$Trial, con7$Trial)]
 
 Control$pcb.50hz = Control$X50hz.frequency / Control$avg_50hz
 
 
  
 # finding the percent change from baseline in 100 Hz vibrations

 
  
 con8 = con1 %>%
  group_by(Trial)%>%
  summarise(avg_100hz = mean(X100hz.frequency, na.rm = TRUE))


 Control$avg_100hz = con8$avg_100hz[match(Control$Trial, con8$Trial)]
 
 Control$pcb.100hz = Control$X100hz.frequency / Control$avg_100hz  

 
 library(splitstackshape)
 
 Control5 = getanID(data = Control, id.vars = "Trial")
 
Control$ramp.num = Control5$.id


``` 
###Combination line plot

 Produces a combination line plot for resting discharge, DP, IST, FST, DI, 50 hz vibrations, 100 hz vibrations. 
```{r CombinationLineplot, fig.height = 7, fig.width= 9}


library(ggplot2)


#graphs for Experiment group

#plot of each type over time and will display each graph individually for Experiment group

#resting discharge

ggplot(Exp, aes(x= ramp.num, y= pcb.resting.discharge, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("Resting Discharge")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.resting.discharge), max(Exp$pcb.resting.discharge), by = 0.5),1)) 
  

#resting discharge

ggplot(Exp, aes(x= ramp.num, y= pcb.resting.discharge, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("Resting Discharge")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.resting.discharge), max(Exp$pcb.resting.discharge), by = 0.5),1)) 
  

#plot of DP

ggplot(Exp, aes(x = ramp.num, y=pcb.DP, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("Dynamic Peak")+
theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.DP), max(Exp$pcb.DP), by = 0.1),1))



#plot of IST

ggplot(Exp, aes(x=ramp.num, y=pcb.IST, color= Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("IST") +
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number",breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.IST), max(Exp$pcb.IST), by = 0.1),1))


#plot of FST

ggplot(Exp, aes(x=ramp.num, y=pcb.FST, color = Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1)) +
  ggtitle("FST")+
  theme(plot.title = element_text(hjust=0.5))+
   scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.FST), max(Exp$pcb.FST), by = 0.1),1))


#plot of DI
ggplot(Exp, aes(x= ramp.num, y= pcb.DI, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("DI")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.DI), max(Exp$pcb.DI), by = 0.1),1)) 
  


#plot of 50hZ vibrations
ggplot(Exp, aes(x= ramp.num, y= pcb.50hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("50 Hz Vibrations")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.50hz), max(Exp$pcb.50hz), by = 0.5),1)) 


#plot of 100hz vibrations
ggplot(Exp, aes(x= ramp.num, y= pcb.100hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("100 Hz vibrations")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.100hz), max(Exp$pcb.100hz), by = 0.5),1))
  

```




```{r controlComboplot,fig.height = 7, fig.width= 9}
#plot of graphs for control group


#resting discharge

ggplot(Control, aes(x= ramp.num, y= pcb.resting.discharge, color = Trial)) +
    geom_point()+
     geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("Control Resting Discharge")+
  theme(plot.title = element_text(hjust=0.5))+scale_x_continuous("Time(Min.)")+
   scale_x_continuous("Ramp number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent,  breaks = round(seq(min(Control$pcb.resting.discharge), max(Control$pcb.resting.discharge), by = 0.1),1)) 



#DP

ggplot(Control, aes(x = ramp.num, y=pcb.DP, color = Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
ggtitle("Control Dynamic Peak")+
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.DP), max(Control$pcb.DP), by = 0.1),1))
  


#IST

ggplot(Control, aes(x=ramp.num, y=pcb.IST, color= Trial))+  
  geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1)) +
  ggtitle("Control IST")+
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number",breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.IST), max(Control$pcb.IST), by = 0.1),1))

#FST

ggplot(Control, aes(x=ramp.num, y=pcb.FST, color = Trial))+
  geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("Control FST")+
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.FST), max(Control$pcb.FST), by = 2),1))
  


#plot of DI
ggplot(Control, aes(x= ramp.num, y= pcb.DI, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("Control DI")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.DI), max(Control$pcb.DI), by = 0.1),1)) 
  


#plot of 50hZ vibrations
ggplot(Control, aes(x= ramp.num, y= pcb.50hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("50 Hz Vibrations Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.50hz), max(Control$pcb.50hz), by = 0.5),1)) 


#plot of 100hz vibrations
ggplot(Control, aes(x= ramp.num, y= pcb.100hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("100 Hz vibrations Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Control$ramp.num), max(Control$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Control$pcb.100hz), max(Control$pcb.100hz), by = 0.5),1)) 







#saving plots to folder 
#library(ggplot2)
#ggsave('file.name.png', plot = x1, device = 'png', path = 'C:\\Users\\Arthur\\255E\\Neural_R\\plot_output')

```

### Multiple plot for multiple line plot

Produces a multiplot for each combination line plot. Baseline tension, peak tension, average tension 3.25-3.75 of 4 sec. static stretch, and minimum tension) that shows the percent change from baseline (first 20 minutes of experiment) over time of the experiment and contains a legend for the date of each trial. 
```{r combinationLineplot, fig.height = 7, fig.width= 10}

#combining the individual plots so they can be compared


# new funciton called multiple plot funciton

# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}



#create labels for each plot Experiment 

library(ggplot2)


#resting discharge

a1 = ggplot(Exp, aes(x= ramp.num, y= pcb.resting.discharge, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("Resting Discharge")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.resting.discharge), max(Exp$pcb.resting.discharge), by = 0.5),1))+
  theme(legend.position = "none")+
annotate("text", x=9, y=1.5, label = "25uM NE")+
  annotate("text", x=31, y=.8, label = "10uM NE")

#plot of DP

b1 = ggplot(Exp, aes(x = ramp.num, y=pcb.DP, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("Dynamic Peak")+
theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.DP), max(Exp$pcb.DP), by = 0.1),1))+
  theme(legend.position = "none")+
annotate("text", x=9, y=1.2, label = "25uM NE")+
  annotate("text", x=31, y=.8, label = "10uM NE")



#plot of IST

c1 = ggplot(Exp, aes(x=ramp.num, y=pcb.IST, color= Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("IST") +
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number",breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.IST), max(Exp$pcb.IST), by = 0.1),1))+
  theme(legend.position = "none")+
annotate("text", x=9, y=1.1, label = "25uM NE")+
  annotate("text", x=31, y=.8, label = "10uM NE")


#plot of FST

d1 = ggplot(Exp, aes(x=ramp.num, y=pcb.FST, color = Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1)) +
  ggtitle("FST")+
  theme(plot.title = element_text(hjust=0.5))+
   scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.FST), max(Exp$pcb.FST), by = 0.1),1))+
annotate("text", x=9, y=1.5, label = "25uM NE")+
  annotate("text", x=31, y=.8, label = "10uM NE")+
theme(legend.position = "none")


#plot of DI
e1 = ggplot(Exp, aes(x= ramp.num, y= pcb.DI, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("DI")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.DI), max(Exp$pcb.DI), by = 0.4),1))+
  #theme(legend.position = "none")+
annotate("text", x=9, y=1.5, label = "25uM NE")+
  annotate("text", x=31, y=.8, label = "10uM NE")
 
  


#plot of 50hZ vibrations
f1 = ggplot(Exp, aes(x= ramp.num, y= pcb.50hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("50 Hz Vibrations")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.50hz), max(Exp$pcb.50hz), by = 0.6),1))+
  theme(legend.position = "none")


#plot of 100hz vibrations
#g1 = ggplot(Exp, aes(x= ramp.num, y= pcb.100hz, color = Trial)) +
   # geom_point()+
  #geom_line()+
  #geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  #ggtitle("100 Hz vibrations")+
  #theme(plot.title = element_text(hjust=0.5)) +
 # scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  #theme(axis.text.x = element_text(angle = 45, hjust = 1))+
 # scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.100hz), max(Exp$pcb.100hz), #by = 0.6),1))

  

#use the multiplot function to combine all plots in multiplot function

multiplot(a1,b1,e1, c1,d1, cols=2)
```
#creating labels for control plot 

multiplot control

```{r MultiplotControl, fig.height= 10, fig.width=12}


# multiple plots combined for control

#create labels for each plot Experiment 

library(ggplot2)


#resting discharge

a2 = ggplot(Control, aes(x= ramp.num, y= pcb.resting.discharge, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("Resting Discharge Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.resting.discharge), max(Exp$pcb.resting.discharge), by = 0.5),1))+
  theme(legend.position = "none")

#plot of DP

b2 = ggplot(Control, aes(x = ramp.num, y=pcb.DP, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("Dynamic Peak Control")+
theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.DP), max(Exp$pcb.DP), by = 0.1),1))+
  theme(legend.position = "none")



#plot of IST

c2 = ggplot(Control, aes(x=ramp.num, y=pcb.IST, color= Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+
  ggtitle("IST Control") +
  theme(plot.title = element_text(hjust=0.5))+
  scale_x_continuous("Ramp number",breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.IST), max(Exp$pcb.IST), by = 0.1),1))+
  theme(legend.position = "none")


#plot of FST

d2 = ggplot(Control, aes(x=ramp.num, y=pcb.FST, color = Trial))+
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1)) +
  ggtitle("FST Control")+
  theme(plot.title = element_text(hjust=0.5))+
   scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.FST), max(Exp$pcb.FST), by = 0.1),1))+
  theme(legend.position = "none")


#plot of DI
e2 = ggplot(Control, aes(x= ramp.num, y= pcb.DI, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("DI Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Ramp number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.DI), max(Exp$pcb.DI), by = 0.4),1))+
  theme(legend.position = "none")
  


#plot of 50hZ vibrations
f2 = ggplot(Control, aes(x= ramp.num, y= pcb.50hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("50 Hz Vibrations Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.50hz), max(Exp$pcb.50hz), by = 0.6),1))+
  theme(legend.position = "none")


#plot of 100hz vibrations
g2 = ggplot(Control, aes(x= ramp.num, y= pcb.100hz, color = Trial)) +
    geom_point()+
  geom_line()+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("100 Hz vibrations Control")+
  theme(plot.title = element_text(hjust=0.5)) +
  scale_x_continuous("Vibration number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline",labels = scales::percent, breaks = round(seq(min(Exp$pcb.100hz), max(Exp$pcb.100hz), by = 0.6),1))

  

#use the multiplot function to combine all plots in multiplot function

multiplot(a2,b2,c2,d2,e2,f2,g2, cols=3)


#library(ggplot2)
#saving plots to folder 

#ggsave('file.name.png', plot = last_plot(), device = 'png', path = 'C:\\Users\\Arthur\\255E\\Neural_R\\plot_output')

```

###side by side plot of Exp and Control


```{r ControlExpMultiplot, fig.height= 15, fig.width=11}
#creates two columns to compare treatment and control

#creates facet of multiple graphs comparing treatment to control

multiplot(a1,b1,c1,d1,e1,f1,g1,a2,b2,c2,d2,e2,f2,g2, cols =2)


  
```
###Plot of averages

 Produces a line plot of averages compared to time of experiment for multiple trials for FST with error bars. This code will produce a graph of averages for treatment and control, a single plot of averages with two lines with error bars for treatment and control, and both individual graphs of average treatment and control faceted together.   

```{r plotAverages,fig.height = 7, fig.width= 8}

#groups the ramp number and takes the average of all SR values for both experiment and control

#experimnet group calculations

#experiment subset and calculation of mean, standard deviation, and standard error. 

library(dplyr)


Exp8 = Exp %>%
  group_by(Macro)%>%
  summarise(avg.all.macro = mean(FST, na.rm = TRUE))


 Exp8_sd = Exp%>%
  group_by(Macro)%>%
  summarise(sd = sd(FST, na.rm = TRUE))

 Exp8$sd = Exp8_sd$sd
 
Exp10 = as.data.frame(table(Exp$Macro))
  Exp9 =  sqrt(Exp10$Freq)
 Exp8$SE = Exp8$sd / Exp9

 Exp8$ymin = Exp8$avg.all.macro - Exp8$SE
 Exp8$ymax = Exp8$avg.all.macro + Exp8$SE
 
 Exp8$type = "Drug"
 
 

#control subset and calculation of mean, standard deviation, and standard error.  
 
 Con8 = Control %>%
  group_by(Macro)%>%
  summarise(avg.all.macro = mean(FST, na.rm = TRUE))

 Con8_sd = Control%>%
  group_by(Macro)%>%
  summarise(sd = sd(FST, na.rm = TRUE))

 Con8$sd = Con8_sd$sd
 
 
Con10 = as.data.frame(table(Control$Macro))
   Con9 =  sqrt(Con10$Freq)
   Con8$SE = Con8$sd / Con9

   Con8$ymin = Con8$avg.all.macro - Con8$SE
   Con8$ymax = Con8$avg.all.macro + Con8$SE
   
    Con8$type = "Control"
 
 
    
    #binds data frame to compare treatment and control in plot
     Exp_Con = rbind(Exp8, Con8)
 
     
     
     

library(ggplot2)

#plot of treatment group
   ggplot(Exp8,aes(x=Macro, y=avg.all.macro, group = type, color = type)) + 
   geom_errorbar(aes(ymin= ymin, ymax=ymax), width= .1) +
    geom_line() +
     scale_colour_manual(values = "steelblue")+
    geom_point()+
       ggtitle("Average SR versus Time for Treatment Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Macro\n", y = "Average SR\n")+
        scale_x_continuous(breaks = round(seq(min(Exp8$Macro), max(Exp8$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
     
     
#plot of control group 
     
   ggplot(Con8, aes(x=Macro, y=avg.all.macro, group =type, color = type)) + 
   geom_errorbar(aes(ymin= ymin, ymax=ymax), width=.1) +
    geom_line() +
     scale_colour_manual(values = "darkblue")+
    geom_point()+
       ggtitle("Average SR versus Time for Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Macro\n", y = "Average SR\n")+
        scale_x_continuous(breaks = round(seq(min(Con8$Macro), max(Con8$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))   
   
   
   
   
# side by side plot of control and treatment 
   
    z1= ggplot(Exp8,aes(x=Macro, y=avg.all.macro, colour= type)) + 
   geom_errorbar(aes(ymin= ymin, ymax=ymax), width=.1) +
       scale_colour_manual(values = "steelblue")+
    geom_line() +
    geom_point()+
    # ggtitle("Average SR versus Time for Treatment and Control\n")+
      #theme(plot.title = element_text(hjust=0.5))+
         scale_x_continuous(breaks = round(seq(min(Exp8$Macro), max(Exp8$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
 
    
 z2=  ggplot(Con8, aes(x=Macro, y=avg.all.macro, colour= type)) + 
   geom_errorbar(aes(ymin= ymin, ymax=ymax), width=.1) +
   scale_colour_manual(values = "green")+
    geom_line() +
    geom_point()+
   ggtitle("Average SR versus Time for Treatment and Control\n")+
      theme(plot.title = element_text(hjust=0.5))+
   scale_x_continuous("Macro", breaks = round(seq(min(Con8$Macro), max(Con8$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
     # +theme(axis.title.x=element_blank(),
     #   axis.text.x=element_blank(),
     #   axis.ticks.x=element_blank())
   
   
 multiplot(z2,z1, cols = 1)  
     
# single graph comparing treatment and control
 
ggplot(Exp_Con, aes(x=Macro, y=avg.all.macro, colour= type)) + 
  geom_errorbar(aes(ymin= ymin, ymax=ymax), width=.1) +
    geom_line() +
    geom_point()+
    ggtitle("Average SR versus Time for Treatment and Control\n")+
 theme(plot.title = element_text(hjust=0.5))+
 labs(x="Macro\n", y = "Average SR\n")+
     scale_x_continuous("Time(Min.)", breaks = round(seq(min(Exp_Con$Macro), max(Exp_Con$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))


#faceting data to compare treatment and control
Exp_Con = rbind(Exp8,Con8)

ggplot(Exp_Con, aes(x=Macro, y=avg.all.macro, group = type, color = type))+
  geom_line()+
  scale_colour_manual(values = c("steelblue", "darkblue"))+
  geom_point()+
  geom_errorbar(aes(ymin=ymin, ymax=ymax), width = .1)+
  facet_grid(type~.)+
  ggtitle("Average SR versus Time for Treatment and Control\n")+
  theme(plot.title = element_text(hjust=0.5))+
#theme(legend.position = "none")#+   #uncomment if you want to remove legend
#expand_limits(y=0)#+   #if you want to change the limits of the y-axis, uncomment and set the scale for y axis
labs(x="Macro\n", y = "Average SR\n")+
     scale_x_continuous(breaks = round(seq(min(Exp_Con$Macro), max(Exp_Con$Macro), by=1),1))+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
 
 



  
```


###Dot plots with mean and error bars

Produces multiple dot plots with error bars. Points represent the average value of SR (3.25-3.75 of static stretch) across all trails per macro. Different graphs are produced for experiment and control, as well Experiment and Control side by side, and on the same graph.  


```{r dotPlot, fig.height = 7, fig.width= 8}

#Experimental group subsetting and calculation of mean, standard deviation, and standard error. 

library(dplyr)
Exp_11 = Exp%>%
  group_by(Macro)%>%
  summarise(avg = mean(FST, na.rm = TRUE))
 
Exp_12 = Exp%>%
  group_by(Macro)%>%
  summarise(SD = sd(FST, na.rm=TRUE))

Exp_13 = as.data.frame(table(Exp$Macro))
Exp_11$SD = Exp_12$SD
Exp_11$n = as.numeric(Exp_13$Freq)
Exp_11$sqrt = sqrt(Exp_11$n)
Exp_11$SE = Exp_11$SD / Exp_11$sqrt
Exp_11$ymin = Exp_11$avg - Exp_11$SE
Exp_11$ymax = Exp_11$avg + Exp_11$SE
Exp_11$type = "Drug"


#plot of average for macro FST per macro scatter plot with errorbars Experiment 



library(ggplot2)

Exp8$num.type = 1
Exp8$min1 = mean(Exp8$ymin)
Exp8$max1 = mean(Exp8$ymax)


   ggplot(Exp8,aes(x=num.type, y=avg.all.macro, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("Average SR for Treatment Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Drug\n", y = "Average SR\n")+
         theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
        
   
   

   
#plot of average for macro Bl.Tension per macro scatterplot with errorbars Control    

   Con8$num.type = 1.1

Con8$min1 = mean(Con8$ymin)
Con8$max1 = mean(Con8$ymax)


   ggplot(Con8,aes(x=num.type, y=avg.all.macro, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("Average SR for Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Average SR\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   

   

# plot comparing treatment and control scatter plots with errorbars. 

      #for multiplot
   b3=(ggplot(Con8,aes(x=num.type, y=avg.all.macro, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("Average SR for Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Control\n", y = "Average SR\n"))+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
   
   
      #for later multiplot
  a3= (ggplot(Exp8,aes(x=num.type, y=avg.all.macro, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("Average SR versus Time for Treatment Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Drug\n", y = "Average SR\n"))+
       theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
   multiplot(a3,b3)
   
   #combining treatment and control using facet
   
Exp_Con11 = rbind(Exp8,Con8)

ggplot(Exp_Con11, aes(x=num.type, y=avg.all.macro, group = num.type, color = Macro))+
  #scale_colour_manual(values = c("steelblue", "darkblue"))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
    theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
#theme(axis.text.x = element_text(angle = 0, hjust = 1))+
  geom_jitter()+
  facet_grid(type~.)+
  labs(x="Experiment type\n", y = "Average of all Macros\n")


#side by side experiment and control scatter plot with wrror bars

ggplot(Exp_Con11, aes(x=Exp_Con11$type, y=avg.all.macro, group = num.type, color =Macro))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
  geom_jitter()+
  ggtitle("Average SR for treatment and control")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Experiment type\n", y = "Average of all Macros\n")
 
 

```
# dot plot for percent change from baseline for vibrations 50 hz and 100hz compared to control

```{r dotPlotvibrations, fig.width=9, fig.height= 7}

#Experimental group 50 hz subsetting and calculation of mean, standard deviation, and standard error. 

library(dplyr)
Exp_17 = Exp%>%
  group_by(Macro)%>%
  summarise(avg = mean(pcb.50hz, na.rm = TRUE))
 
Exp_18 = Exp%>%
  group_by(Macro)%>%
  summarise(SD = sd(pcb.50hz, na.rm=TRUE))

Exp_19 = as.data.frame(table(Exp$Macro))
Exp_17$SD = Exp_18$SD
Exp_17$n = as.numeric(Exp_19$Freq)
Exp_17$sqrt = sqrt(Exp_17$n)
Exp_17$SE = Exp_17$SD / Exp_17$sqrt
Exp_17$ymin = Exp_17$avg - Exp_17$SE
Exp_17$ymax = Exp_17$avg + Exp_17$SE
Exp_17$type = "50 Hz Drug"

Exp_17$num.type = 1
Exp_17$min1 = mean(Exp_17$ymin)
Exp_17$max1 = mean(Exp_17$ymax)

#Experimental group 100 hz subsetting and calculations of mean, standard deviation, and standard error
Exp_14 = Exp%>%
  group_by(Macro)%>%
  summarise(avg = mean(pcb.100hz, na.rm = TRUE))


Exp_15 = Exp%>%
  group_by(Macro)%>%
  summarise(SD = sd(pcb.100hz, na.rm=TRUE))

Exp_16 = as.data.frame(table(Exp$Macro))
Exp_14$SD = Exp_15$SD
Exp_14$n = as.numeric(Exp_16$Freq)
Exp_14$sqrt = sqrt(Exp_14$n)
Exp_14$SE = Exp_14$SD / Exp_14$sqrt
Exp_14$ymin = Exp_14$avg - Exp_14$SE
Exp_14$ymax = Exp_14$avg + Exp_14$SE
Exp_14$type = "100 Hz Drug"

Exp_14$num.type = 1.1
Exp_14$min1 = mean(Exp_14$ymin)
Exp_14$max1 = mean(Exp_14$ymax)
#Control group 50 hz subsetting and calculations of mean, standard deviation, and standard error

 
 con_19 = Control %>%
  group_by(Macro)%>%
  summarise(avg = mean(pcb.50hz, na.rm = TRUE))

 Con_20 = Control%>%
  group_by(Macro)%>%
  summarise(SD = sd(pcb.50hz, na.rm = TRUE))

Con_21 = as.data.frame(table(Control$Macro))
con_19$SD = Con_20$SD
con_19$n = as.numeric(Con_21$Freq)
con_19$sqrt = sqrt(con_19$n)
con_19$SE = con_19$SD / con_19$sqrt
con_19$ymin = con_19$avg - con_19$SE
con_19$ymax = con_19$avg + con_19$SE
con_19$type = "50 Hz Control"
 
con_19$num.type = 1.2
con_19$min1 = mean(con_19$ymin)
con_19$max1 = mean(con_19$ymax)
 
#Control group 100 Hz subsetting and calculations of mean, standard deviation, and standard error 

 
 Con_22 = Control %>%
  group_by(Macro)%>%
  summarise(avg = mean(pcb.100hz, na.rm = TRUE))

 Con_23 = Control%>%
  group_by(Macro)%>%
  summarise(SD = sd(pcb.100hz, na.rm = TRUE))

Con_24 = as.data.frame(table(Control$Macro))
 Con_22$SD = Con_23$SD
 Con_22$n = as.numeric(Con_24$Freq)
 Con_22$sqrt = sqrt(Con_22$n)
 Con_22$SE = Con_22$SD / Con_22$sqrt
 Con_22$ymin = Con_22$avg - Con_22$SE
 Con_22$ymax = Con_22$avg + Con_22$SE
 Con_22$type = "50 Hz Control"

 Con_22$num.type = 1.3
Con_22$min1 = mean(Con_22$ymin)
Con_22$max1 = mean(Con_22$ymax)

#binds data frame to compare treatment and control in plot
    
Exp_Con13 = rbind(Exp_14, Exp_17)
Exp_Con14 = rbind(Con_22, con_19)
Exp_Con12 = rbind(Exp_17, Exp_14, Con_22, con_19)
 

     
library(ggplot2)
     
     
#plot of percent chnage from baseline for Experiment 50 hz scatter plot with errorbars Experiment 

   ggplot(Exp_17,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("50 Hz Vibrations\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Drug\n", y = "Percent Change from Baseline\n")+
         theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
        
   
   
#plot of percent chnage from baseline for Experiment 100 hz scatter plot with errorbars Experiment   


   ggplot(Exp_14,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("100 Hz vibrations\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
#plot of percent chnage from baseline for Experiment 50 hz scatter plot with errorbars control   


   ggplot(con_19,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("50Hz Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
#plot of percent chnage from baseline for Experiment 100 hz scatter plot with errorbars control 


   ggplot(Con_22,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("100 Hz Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

   
   
      

# plot comparing treatment and control scatter plots with errorbars. 

      #for multiplot
   b3=   ggplot(Exp_17,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("50 Hz Vibrations\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Drug\n", y = "Percent Change from Baseline\n")+
         theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
   
  b4 = ggplot(Exp_14,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("100 Hz vibrations\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
  b5 = ggplot(con_19,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("50Hz Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
   
b6 =  
   ggplot(Con_22,aes(x=num.type, y=avg, group = type, color = Macro)) + 
   geom_errorbar(aes(ymin=min1 , ymax=max1), width= 20) +
   geom_point()+
     geom_jitter()+
     ggtitle("100 Hz Control Group\n")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Type\n", y = "Percent Change from Baseline\n")+
        theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

   
   

  # multiplot(b3, b4, b5, b6, col = 2)
   
   

   #combining treatment and control using facet
   


ggplot(Exp_Con12, aes(x=num.type, y=avg, group = num.type, color = Macro))+
  #scale_colour_manual(values = c("steelblue", "darkblue"))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
    theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
#theme(axis.text.x = element_text(angle = 0, hjust = 1))+
  geom_jitter()+
  facet_grid(type~.)+
  labs(x="Experiment type\n", y = "Average of all Macros\n")


#side by side experiment and control scatter plot with wrror bars

ggplot(Exp_Con13, aes(x=Exp_Con13$type, y=avg, group = num.type, color =Macro))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
  geom_jitter()+
  ggtitle("50hz and 100Hz vibrations")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Experiment type\n")+
  scale_y_continuous("Percent change from baseline\n",labels = scales::percent, breaks = round(seq(min(Exp_Con12$avg), max(Exp_Con12$avg), by = 0.6),1))
  

z1 = ggplot(Exp_Con13, aes(x=Exp_Con13$type, y=avg, group = num.type, color =Macro))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
  geom_jitter()+
  ggtitle("50hz and 100Hz vibrations")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Experiment type\n")+
  scale_y_continuous("Percent change from baseline\n",labels = scales::percent, breaks = round(seq(min(Exp_Con12$avg), max(Exp_Con12$avg), by = 0.6),1))

z2 = ggplot(Exp_Con14, aes(x=Exp_Con14$type, y=avg, group = num.type, color =Macro))+
  geom_point()+
  geom_errorbar(aes(ymin=min1, ymax= max1), size=0.5,   
    width=.25,position=position_dodge(.9))+
  geom_jitter()+
  ggtitle("50hz and 100Hz vibrations Control")+
  theme(plot.title = element_text(hjust=0.5))+
  labs(x="Experiment type\n")+
  scale_y_continuous("Percent change from baseline\n",labels = scales::percent, breaks = round(seq(min(Exp_Con12$avg), max(Exp_Con12$avg), by = 0.6),1))

 multiplot(z1, z2)

```

###Line plot with data visulization and standard deviation

Produces a line plot of peak tension as a percent change from FST over time of experiment. This graph also includes a picture of the afferent firing caused by the first static stretch. The caption of this graph lists the standard deviation values for each 20-minute period of the experiment. 

```{r lineDatavisualization, fig.height = 8, fig.width= 10}

library(dplyr)
library(png)
library(ggplot2)
library(grid)
#calculating standard deviation

 Exp8_sd = Exp%>%
  group_by(Macro)%>%
  summarise(sd = sd(FST, na.rm = TRUE))

Exp$sd = Exp8_sd$sd[match(Exp$Macro, Exp8_sd$Macro)]
my.labels <- paste(Exp$ramp.num, "\n (", Exp$sd, "%)")



#graph with image

img <- readPNG("C:\\Users\\Arthur\\255E\\Neural_R\\img\\img.png")

g <- rasterGrob(img, interpolate=TRUE, height = 1, width = 1) #chnage height and width of the image 

  ggplot(Exp, aes(x= ramp.num, y= pcb.FST, color = Trial)) +
    geom_point()+
  geom_line()+
    annotation_custom(g, xmin=-Inf, xmax=Inf, ymin= max(Exp$pcb.FST) , ymax=Inf)+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("FST")+
  theme(plot.title = element_text(hjust=0.5)) +
    scale_x_continuous("Time(Min.)", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
   theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent change from baseline", labels = scales::percent, breaks = round(seq(min(Exp$pcb.FST), max(Exp$pcb.FST), by = 0.1),1))+
    expand_limits(y=1.7)
    
   
  
  #divides the standard deviation for each macro so it can be subsetted
  w1 = Exp8_sd$sd[1]
w2 = Exp8_sd$sd[2]
w3 = Exp8_sd$sd[3]
w4 = Exp8_sd$sd[4]
w5 = Exp8_sd$sd[5]
w6 = Exp8_sd$sd[6]
w7 =Exp8_sd$sd[7]

    
  # until I can find a better way to do this, highlight the line below, you will copy and paste these values under the caption on line 1086



cat( w1, w2, w3, w4, w5, w6, w7, sep = "  ")
   #mysds = c( w1, w2, w3, w4, w5, w6, w7)
  # mysds = round(mysds, digits = 3)
  # mysds2 = paste(sprintf(fmt ="%2.3f", mysds), collapse=' ')
   #mysds2  = paste("Standard Deviation:",mysds2)
    
    
 #graph with image and standard deviation 
    
    img <- readPNG("C:\\Users\\Arthur\\255E\\Neural_R\\img\\img.png")

g <- rasterGrob(img, interpolate=TRUE, height = 1, width = 1) #chnage height and width of the image 

  ggplot(Exp, aes(x= ramp.num, y= pcb.FST, color = Trial)) +
    geom_point()+
  geom_line()+
    annotation_custom(g, xmin=-Inf, xmax=Inf, ymin= max(Exp$pcb.FST) , ymax=Inf)+
  geom_smooth(method ="lm", se=FALSE, color = "black", aes (group = 1))+ 
  ggtitle("FST")+
  theme(plot.title = element_text(hjust=0.5)) +
    scale_x_continuous("Ramp Number", breaks = round(seq(min(Exp$ramp.num), max(Exp$ramp.num), by=2),1))+
   theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous("Percent varation from baseline", labels = scales::percent,  breaks = round(seq(min(Exp$pcb.FST), max(Exp$pcb.FST), by = 0.1),1))+
    expand_limits(y=1.7)+
   labs(caption = "Standard Deviation: 0.7652525  0.8857445  1.98097  1.286898  2.318214") 
   
  
  #annotate("text", x = seq(from = 6, to = max(x-axis), by = 6), y = , label = mysds)

  
  

 
```

###Table Output

outputs a table for 10 sec. before static stretch (baseline tension), peak tension, average tension 3.25-3.75 of 4 sec. static stretch, and minimum in an excel sheet printed to a folder ..Tension_R\\Exp_output. Each row in the table are values found for each ramp within a macro (6 ramps in a macro). The columns organize the macro values and group them by trial and type of analysis (baseline, peak, SR, and minimum) and calculated average for each row, 


```{r tableOutput}

library(xlsx)
library(rJava)
library(dplyr)
library(reshape2)
library(reshape)


#dataframe manipulation for output format



#reshape data resting discharge

library(reshape)
Exp_19 = cast(Exp, Trial~ramp.num, value = "Resting.discharge" )
Exp_19$type = "Resting.discharge"
Exp_19$type.num = "4"


#reshape data DP
Exp_21 = cast(Exp, Trial~ramp.num, value = "DP")
Exp_21$type = "DP"
Exp_21$type.num = "3"

#reshape data IST
Exp_22 = cast(Exp, Trial~ramp.num, value = "IST")
Exp_22$type = "IST"
Exp_22$type.num = "2"

#reshape data FST

Exp_23 = cast(Exp, Trial~ramp.num, value = "FST")
Exp_23$type = "FST"
Exp_23$type.num = "1"

Exp_24 = cast(Exp, Trial~ramp.num, value = "DI")
Exp_24$type = "DI"
Exp_24$type.num = "5"

Exp_25 = cast(Exp, Trial~ramp.num, value = "X50hz.frequency")
Exp_25$type = "X50hz.frequency"
Exp_25$type.num = "6"

Exp_26 = cast(Exp, Trial~ramp.num, value = "X100hz.frequency")
Exp_26$type = "X100hz.frequency"
Exp_26$type.num = "7"

Exp_28 = bind_rows(list(Exp_19, Exp_21, Exp_22, Exp_23, Exp_24, Exp_25, Exp_26))

library(dplyr)

Exp_29 = Exp_28%>%
  arrange(Trial)


#attempt to get data to work with forloop


Exp_31 = data.frame(Exp_29$type)
Exp_31$type = Exp_31$Exp_29.type
Exp_31$Exp_29.type = NULL
Exp_31$type.num = Exp_29$type.num
Exp_29$type = NULL
Exp_29$type.num = NULL

Exp_29$'31' = NA
Exp_29$'32' = NA
Exp_29$'33' = NA
Exp_29$'34' = NA
Exp_29$'35' = NA
Exp_29$'36' = NA
Exp_29$'37' = NA
Exp_29$'38' = NA
Exp_29$'39' = NA
Exp_29$'40' = NA
Exp_29$'41' = NA
Exp_29$'42' = NA

Exp_29$type = Exp_31$type
Exp_29$type.num = Exp_31$type.num


# Reorganizing data frame 

#Exp_26 = Exp_25

#Exp_26$type.num = NULL
# creating a new data frame for data output

#newdf = data.frame(matrix(NA, nrow = 24, ncol = 8))

#for loop to organize data

for(i in 1:nrow(Exp_29)){
  cols  = c(2,8,14,20,26,32,38)
   for(j in 1:length(cols)){
     #print(cols[j])
     if (j == 1 & i == 1){
      temp = Exp_29[i,cols[j]:(cols[j]+5)]
      temp$Trial = Exp_29[i,"Trial"]
      temp$type = Exp_29[i,"type"]
     } else {
      temp2 = Exp_29[i,cols[j]:(cols[j]+5)]
      temp2$Trial = Exp_29[i,"Trial"]
      temp2$type = Exp_29[i,"type"]
      colnames(temp2)[1:6] = as.character(1:6)
      temp = rbind(temp,temp2)
     }
  }
}
Exp_30 = temp
 

#adding a column to Exp_30 that calculates the average calue for each row of numeric variables


Exp_30$Average = apply(Exp_30[1:6], 1 , mean)


#write dataframe to excel sheet

write.xlsx(Exp_30, file = "C:\\Users\\Arthur\\255E\\Neural_R\\Exp_output\\Exp_out.xlsx", sheetName="Sheet1")



```




